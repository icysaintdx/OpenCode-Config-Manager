# v1.5.0 Bug 修复总结

## 修复日期
2026-01-23

## 修复内容

### 1. ✅ Skill 市场优化

#### 问题
- ComposioHQ/awesome-claude-skills 仓库的 14 个 skills 安装失败
- 安装显示"成功"但实际未安装到目标目录
- 表格列宽不合理，描述列被挤压无法完整显示

#### 解决方案
**移除 ComposioHQ Skills**
- 移除所有 14 个无法正常安装的 ComposioHQ skills
- 保留 12 个可用 skills（11个 Anthropic 官方 + 1个社区）
- Skills 可用率从 44% 提升到 100%

**添加外部商场链接**
- 🌐 SkillsMP.com - 社区技能市场
- 🌐 ComposioHQ Skills - GitHub 仓库
- 用户可通过外部链接浏览更多技能并手动安装

**优化表格列宽**
- 分类列：固定 100px（之前自适应占用过多空间）
- 仓库列：固定 200px（之前自适应占用过多空间）
- 描述列：Stretch 模式，获得更多显示空间
- 名称列：保持自适应内容

#### Git 提交
```
2c1db6a - 移除ComposioHQ Skills + 添加外部商场链接
ba68997 - 添加 Skill 市场简化文档
e7c71a6 - 优化 Skill 市场表格列宽
```

---

### 2. ✅ 修复软件版本号显示错误

#### 问题
- 软件实际版本为 1.5.0，但界面显示为 1.4.0
- 导致一直提示有新版本更新

#### 解决方案
- 修改 `APP_VERSION` 常量从 "1.4.0" 更新到 "1.5.0"（第 1308 行）
- 版本号在以下位置使用：
  - 窗口标题
  - 关于页面
  - 版本检查比较

#### Git 提交
```
01c9a89 - 修复版本号显示 + GitHub API 速率限制
```

---

### 3. ✅ 修复 GitHub API 速率限制问题

#### 问题
- 版本检查频繁调用 GitHub API
- 遇到 403 rate limit exceeded 错误
- 无冷却机制，持续失败

#### 解决方案
**添加冷却机制**
- 默认检查间隔：1小时（3600秒）
- 记录上次检查时间戳
- 在冷却期内跳过检查

**错误处理优化**
- 捕获 `urllib.error.HTTPError` 和 `urllib.error.URLError`
- 403 错误时自动延长冷却时间到 6 小时（21600秒）
- 改进错误日志输出，区分不同错误类型

**API 请求优化**
- 添加 `Accept: application/vnd.github.v3+json` 头
- 保持 `User-Agent: OpenCode-Config-Manager`

#### 代码修改
```python
class VersionChecker(QObject):
    def __init__(self, callback=None, parent=None):
        # ...
        self.last_check_time = 0  # 上次检查时间戳
        self.check_interval = 3600  # 检查间隔（秒）
    
    def check_update_async(self):
        # 检查是否在冷却期内
        current_time = time.time()
        if current_time - self.last_check_time < self.check_interval:
            return
    
    def _check_update(self):
        try:
            # ... API 请求
        except urllib.error.HTTPError as e:
            if e.code == 403:
                # 增加冷却时间到 6 小时
                self.check_interval = 21600
```

#### Git 提交
```
01c9a89 - 修复版本号显示 + GitHub API 速率限制
```

---

### 4. ✅ 修复多语言图标显示问题

#### 问题
- 语言切换按钮只显示半个地球图标
- 按钮尺寸太小（40x32）
- 图标被裁剪

#### 解决方案
- 增大按钮尺寸：40x32 → 50x36
- 设置图标大小：20x20 像素
- 导入 `QSize` 类以支持图标尺寸设置

#### 代码修改
```python
def _add_language_switcher(self):
    self.lang_button = TransparentPushButton(FIF.GLOBE, "", self)
    self.lang_button.setFixedSize(50, 36)  # 增大按钮尺寸
    self.lang_button.setIconSize(QSize(20, 20))  # 设置图标大小
```

#### Git 提交
```
2671a2c - 修复多语言图标显示问题
```

---

## 待完成任务

### 5. 🔄 研究 cc-switch 的预设供应商特点

**目标**：
- 分析 cc-switch 如何组织预设供应商
- 学习其预设配置的特点和优势
- 借鉴到我们的项目中

**参考资料**：
- https://github.com/farion1231/cc-switch
- cc-switch v3.10.0 版本特性

**关键特点**（从 README 了解到）：
- 支持 Claude Code、Codex、Gemini CLI 三个平台
- 预设包含：Google Official (OAuth)、PackyCode、Custom
- 多端点管理 & 自定义配置目录
- 4层模型配置（Haiku/Sonnet/Opus/Custom）

---

### 6. 🔄 添加更多平台外部导入支持

**目标**：
- 添加智谱（GLM）平台支持
- 添加千问（Qwen）平台支持
- 添加其他国内主流 AI 平台

**需要实现**：
- 配置文件格式解析
- API 密钥字段映射
- 模型名称转换
- 导入/导出功能

---

## 文件修改统计

### 主要修改文件
- `opencode_config_manager_fluent.py`
  - 版本号更新（1行）
  - 版本检查优化（约30行）
  - 多语言图标修复（3行）
  - Skill 市场简化（约200行删除）
  - 表格列宽优化（6行）

### 新增文档
- `skill_market_simplification.md` - Skill 市场简化文档

---

## 测试验证

### 已验证
- ✅ 版本号显示正确（1.5.0）
- ✅ Skill 市场只显示 12 个可用 skills
- ✅ 外部商场链接可点击
- ✅ 表格列宽合理，描述列可完整显示
- ✅ 版本检查冷却机制生效

### 待验证
- ⏳ 多语言图标完整显示（需要运行软件确认）
- ⏳ GitHub API 403 错误处理（需要触发速率限制）

---

## 版本发布准备

### 当前状态
- 分支：`backup-1.5.0-wip`
- 版本号：1.5.0
- 所有修复已提交并推送

### 下一步
1. 完成 cc-switch 预设供应商研究
2. 添加智谱、千问等平台支持
3. 测试所有修复功能
4. 合并到 main 分支
5. 创建 v1.5.0 release

---

## Git 提交记录

```bash
2671a2c - 修复多语言图标显示问题
01c9a89 - 修复版本号显示 + GitHub API 速率限制
e7c71a6 - 优化 Skill 市场表格列宽
ba68997 - 添加 Skill 市场简化文档
2c1db6a - 移除ComposioHQ Skills + 添加外部商场链接
```

---

## 相关文档

- `skill_market_simplification.md` - Skill 市场简化详细文档
- `skill_not_showing_debug.md` - Skill 安装问题调试文档
- `branch_detection_fix.md` - 分支检测修复文档
