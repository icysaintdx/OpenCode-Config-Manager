# OpenCode Config Manager 字体优化说明

## 优化时间
2026-01-23

## 优化目标
解决英文状态下菜单、按钮显示被遮挡的问题，提升整体字体渲染质量。

## 参考项目
参考了 **Any-code** 项目的字体配置方案（位于 `D:\opcdcfg\Any-code`）

## 主要改进

### 1. 字体栈优化

#### 原配置
```python
FONT_FAMILY = "Microsoft YaHei UI, Segoe UI, PingFang SC, Helvetica Neue, Arial"
```

#### 新配置
```python
# Sans-serif 字体栈（用于界面文本）
FONT_FAMILY_SANS = "-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', 'Microsoft YaHei UI', '微软雅黑', 'PingFang SC', 'Hiragino Sans GB', 'SimSun', '宋体', 'Arial Unicode MS', sans-serif"

# Monospace 字体栈（用于代码和等宽文本）
FONT_FAMILY_MONO = "'JetBrains Mono', 'Fira Code', 'SF Mono', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', 'Microsoft YaHei Mono', '微软雅黑', monospace"
```

### 2. 字体栈设计原则

1. **系统原生字体优先**：
   - macOS: `-apple-system`, `BlinkMacSystemFont`
   - Windows: `Segoe UI`
   - Linux: `Roboto`, `Ubuntu`, `Oxygen`

2. **跨平台兼容性**：
   - 包含多个平台的默认字体
   - 确保在不同操作系统上都有良好的显示效果

3. **中文字体作为 fallback**：
   - 中文字体放在后面，避免影响英文显示
   - 包含多个中文字体选项：微软雅黑、PingFang SC、宋体等

4. **专业等宽字体**：
   - 代码编辑器使用专业等宽字体（JetBrains Mono、Fira Code）
   - 支持连字（ligatures）特性

### 3. UI 组件优化

#### 按钮组件
```css
QPushButton, PushButton, PrimaryPushButton, TransparentPushButton, ToolButton {
    font-size: 14px;
    font-family: <FONT_FAMILY_SANS>;
    padding: 6px 16px;
    min-height: 32px;  /* 增加最小高度，防止文字被遮挡 */
}
```

#### 输入框组件
```css
QLineEdit, LineEdit {
    font-size: 14px;
    font-family: <FONT_FAMILY_SANS>;
    padding: 6px 12px;
    min-height: 32px;  /* 增加最小高度 */
}
```

#### 下拉框组件
```css
QComboBox, ComboBox {
    font-size: 14px;
    font-family: <FONT_FAMILY_SANS>;
    padding: 6px 12px;
    min-height: 32px;  /* 增加最小高度 */
}

QComboBox::drop-down {
    width: 30px;  /* 确保下拉箭头有足够空间 */
}
```

#### 表格组件
```css
QHeaderView::section {
    font-weight: 600;
    font-size: 13px;
    font-family: <FONT_FAMILY_SANS>;
    padding: 8px 12px;
    min-height: 36px;  /* 增加表头高度 */
}
```

#### 列表组件
```css
QListWidget::item {
    padding: 8px 12px;
    min-height: 36px;  /* 增加列表项高度 */
}
```

#### 菜单组件
```css
QMenu {
    font-size: 14px;
    font-family: <FONT_FAMILY_SANS>;
    padding: 4px;
}

QMenu::item {
    padding: 8px 24px 8px 12px;
    min-height: 32px;  /* 增加菜单项高度 */
}
```

### 4. 文本编辑器优化

```css
QTextEdit, TextEdit, QPlainTextEdit, PlainTextEdit {
    font-size: 14px;
    font-family: <FONT_FAMILY_MONO>;  /* 使用等宽字体 */
    line-height: 1.6;  /* 增加行高，提升可读性 */
}
```

## 优化效果

### 解决的问题
1. ✅ 英文文本在按钮中被遮挡
2. ✅ 菜单项文字显示不完整
3. ✅ 下拉框选项显示异常
4. ✅ 表格表头文字被截断
5. ✅ 列表项文字显示不清晰

### 改进的方面
1. ✅ 更好的跨平台字体渲染
2. ✅ 统一的字体大小和间距
3. ✅ 更清晰的文字显示
4. ✅ 更好的中英文混排效果
5. ✅ 代码编辑器使用专业等宽字体

## 技术细节

### 字体回退机制
字体栈从左到右依次尝试：
1. 系统原生字体（最优先）
2. 跨平台通用字体
3. 中文字体（fallback）
4. 通用字体族（sans-serif/monospace）

### 最小高度设置
所有交互组件都设置了 `min-height`，确保：
- 文字有足够的垂直空间
- 点击区域足够大
- 视觉上更加舒适

### Padding 优化
增加了合理的内边距：
- 按钮：`6px 16px`（上下 6px，左右 16px）
- 输入框：`6px 12px`
- 菜单项：`8px 24px 8px 12px`（上 8px，右 24px，下 8px，左 12px）

## 兼容性

### 支持的平台
- ✅ Windows 10/11
- ✅ macOS 10.15+
- ✅ Linux (Ubuntu, Fedora, etc.)

### 支持的语言
- ✅ 简体中文
- ✅ 英文
- ✅ 其他拉丁字符语言

## 后续建议

1. **字体大小调整**：
   - 可以根据用户反馈调整 `FONT_SIZE_BODY`（当前 14px）
   - 考虑添加用户自定义字体大小的功能

2. **高 DPI 支持**：
   - 考虑添加 DPI 缩放支持
   - 在高分辨率屏幕上自动调整字体大小

3. **字体权重**：
   - 可以考虑为不同组件设置不同的字体权重
   - 例如：标题使用 600，正文使用 400

4. **行高优化**：
   - 可以为不同组件设置不同的行高
   - 提升多行文本的可读性

## 参考资料

- Any-code 项目字体配置：`D:\opcdcfg\Any-code\src\styles\theme.css`
- Any-code 排版配置：`D:\opcdcfg\Any-code\src\styles\typography.css`
- QFluentWidgets 文档：https://qfluentwidgets.com/
- Qt QSS 文档：https://doc.qt.io/qt-5/stylesheet.html
